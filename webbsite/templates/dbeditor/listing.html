{%extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!--#include file="cotop.inc"-->
{% if p>0 %}
	<h2>{{ orgName }}</h2>
	{# TODO: Port ASP logic: Call orgbar(p,8)
	If i>0 Then	Call issueBar(i,5)
E... #}

<h3>{{ title }}</h3>
{% if i>0 %}
	<form method="post" action="listing.asp">
		<input type="hidden" name="i" value="{{ i }}">
		<table class="txtable">
			<tr><td>Issuer</td><td><a target='_blank' href='https://webb-site.com/dbpub/orgdata.asp?p={{ p }}'>{{ orgName }}</a></td></tr>
			<tr><td>Issue ID</td><td>{{ i }}</td></tr>
			<tr><td>Issue type</td><td>{{ typeLong }}</td></tr>
			<tr><td>Currency</td><td>{{ currName }}</td></tr>
			<tr><td>Maturity</td><td>{{ maturity }}</td></tr>
		</table>
		
			<table class="numtable">
				<tr>
					<th>Listing ID</th>
					<th>Stock code</th>
					<th>Exchange</th>
					<th>First trade</th>
					<th>Last trade</th>
					<th>Delist</th>
					<th>Reason</th>
					<th colspan="2"></th>
				</tr>
			{% for row in results %}
				<tr>
					<td>{{ row.ID }}</td>
					<td>{{ row.StockCode }}</td>
					<td><span class="info">{{ row.shortName }}<span>{{ row.longName }}</span></span></td>
					<td>{{ row.FirstTradeDate }}</td>
					<td>{{ row.FinalTradeDate }}</td>
					<td>{{ row.DelistDate }}</td>
					<td>{{ row.Reason }}</td>
					<td><a href='listing.asp?ID={{ row.ID }}'>Edit</a></td>
					{% if Not CBool(row.priced) %}
						<td><a href='listing.asp?submitList=Delete&amp;ID={{ row.ID }}'>Delete</a></td>
					{% else %}
						<td></td>
					{% endif %}
				</tr>
				{# TODO: Port ASP logic: rs.MoveNext
			Loop... #}
			</table>
		{# TODO: Port ASP logic: End If
		rs.Close... #}
		{% if ID>0 %}
			<input type="hidden" name="ID" value="{{ ID }}">
			<h3>Edit listing</h3>
			<table class="txtable">
				<tr><td>Listing ID: </td><td>{{ ID }}</td></tr>
				<tr><td>Exchange: </td><td>{{ conMaster.Execute("SELECT shortName FROM listings WHERE stockExID="&e).Fields(0) }}</td></tr>
				<tr><td>Stock code: </td><td>{{ sc }}</td></tr>
			</table>
		{% else %}
			<h3>Add listing</h3>
			<table>
				<tr><td>Exchange: </td><td>{{ arrSelect("e",e,arrListing,False) }}</td></tr>
				<tr><td>Stock code: </td><td><input type="text" maxlength="8" size="8" name="sc" value="{{ sc }}"></td></tr>
			</table>
		{% endif %}
		<table class="txtable">
			<tr>
				<th>2nd counter?</th>
				<th>First trade</th>
				<th>Last trade</th>
				<th>Delist</th>
				<th>Reason</th>
			</tr>
			<tr>
				<td><input type="checkbox" name="altCtr" value="1" {{ checked(altCtr) }}></td>
				<td>
					{% if ID>0 and priced %}
						<input type="hidden" name="ftd" value="{{ ftd }}">
						{{ ftd }}
					{% else %}
						<input type="date" name="ftd" value="{{ ftd }}">
					{% endif %}
				</td>
				<td><input type="date" name="ltd" value="{{ ltd }}"></td>
				<td><input type="date" name="dld" value="{{ dld }}"></td>
				<td>{{ arrSelectZ("dlr",dlr,arrReason,False,True,"","") }}</td>
			</tr>
		</table>
		{% if hint>"" %}<p><b>{{ Hint }}</b></p>{# TODO: Port ASP logic: End If
		'make buttons
		If ID>0 Then... #}
			<input type="submit" name="submitList" value="Update">
			{% if Not priced %}
				{% if submit="Delete" %}
					<input type="submit" name="submitList" style="color:red" value="CONFIRM DELETE">
					<input type="submit" name="submitList" value="Cancel">
				{% else %}
					<input type="submit" name="submitList" value="Delete">
				{% endif %}
			{% endif %}
		{% else %}
			<input type="submit" name="submitList" value="Add">
		{% endif %}
	</form>
	<form method="post" action="listing.asp">
		<input type="hidden" name="i" value="{{ i }}">
		<input type="submit" name="submitList" value="Clear form">
	</form>
{# TODO: Port ASP logic: End If
Call CloseConRs(con,rs)
Call CloseCon(conMa... #}
<p><a href="issue.asp?tv=i">Find or add an issue</a></p>
<form method="post" action="listing.asp">
	Find using stock code: <input type="number" name="stockCode" min="1" max="999999" step="1" maxlength="6" size="6">
</form>
<hr>
<h3>Rules</h3>
<ul>
	<li>A stock cannot have more than 1 listing on an Exchange at a time.</li>
	<li>You cannot change the stock code of a listing. If the code has changed, 
	that's a new listing.</li>
	<li>You cannot delete a listing or change the First Trade Date if it has 
	begun trading on SEHK.</li>
	<li>A listing of a share is a "2nd counter" on SEHK if it is traded in a non-HKD currency and the same type of 
	shares is listed in HKD.</li>
</ul>
<!--#include file="cofooter.asp"-->
{% endblock %}
