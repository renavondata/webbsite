<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big changes in CCASS holders: {{ stock_name }}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
{% include 'includes/dbheader.html' %}

{% if issue_id == 0 %}
    <h2>Big changes in CCASS holders</h2>
    <p><b>{{ stock_name }}</b></p>
{% else %}
    <h2>{{ stock_name }}</h2>

    {# Organization navigation bar #}
    <ul class="navlist">
        <li><a href="{{ url_for('dbpub_statistics.orgdata', p=person_id) }}">Key Data</a></li>
        <li><a href="{{ url_for('dbpub_corporate.officers', p=person_id) }}">Officers</a></li>
        <li><a href="{{ url_for('dbpub_statistics.overlap', p=person_id) }}">Overlaps</a></li>
        <li><a href="{{ url_for('dbpub_corporate.advisers', p=person_id) }}">Advisers</a></li>
        <li><a href="{{ url_for('dbpub_events.docs', p=person_id) }}">Financials</a></li>
    </ul>
    <div class="clear"></div>

    {# Stock listings table #}
    {% if stock_listings %}
        <table class="numtable" style="margin-top:5px">
        <tr>
        <th class="left">Exchange</th>
        <th>Code</th>
        <th>Listed</th>
        <th>Last trade</th>
        <th>Delisted</th>
        <th></th>
        </tr>
        {% for listing in stock_listings %}
            <tr>
                <td class="left" style="width:75px;vertical-align:middle">{{ listing.listingName }}</td>
                <td style="text-align:left;vertical-align:middle">{{ listing.stockCode }}</td>
                <td style="vertical-align:middle">&nbsp;{{ listing.firstTradeDate.strftime('%Y-%m-%d') if listing.firstTradeDate else '' }}</td>
                <td style="vertical-align:middle">&nbsp;{{ listing.finalTradeDate.strftime('%Y-%m-%d') if listing.finalTradeDate else '' }}</td>
                <td style="vertical-align:middle">&nbsp;{{ listing.delistDate.strftime('%Y-%m-%d') if listing.delistDate else '' }}</td>
                <td></td>
            </tr>
        {% endfor %}
        </table>
        <div class="clear"></div>
    {% endif %}

    {# Stock-specific navigation #}
    <ul class="navlist">
        <li><a href="{{ url_for('dbpub_buybacks.buybacks', i=issue_id) }}">Buybacks</a></li>
        <li><a href="{{ url_for('dbpub_statistics.outstanding', i=issue_id) }}">Outstanding</a></li>
        <li><a href="{{ url_for('dbpub_statistics.str_route', i=issue_id) }}">Total return</a></li>
        <li><a href="{{ url_for('dbpub_statistics.ctr', i1=issue_id) }}">Compare returns</a></li>
        <li><a href="{{ url_for('dbpub_statistics.hpu', i=issue_id) }}">Prices</a></li>
        <li><a href="{{ url_for('dbpub_events.events', i=issue_id) }}">Events</a></li>
    </ul>
    <div class="clear"></div>

    {# CCASS navigation bar #}
    <ul class="navlist">
        <li><a href="{{ url_for('ccass.choldings', i=issue_id, d='') }}">Holdings</a></li>
        <li><a href="{{ url_for('ccass.chldchg', sort='chngdn', i=issue_id, d='') }}">Changes</a></li>
        <li class="livebutton">Big changes</li>
        <li><a href="{{ url_for('ccass.cconchist', i=issue_id) }}">Concentration</a></li>
        <li><a href="{{ url_for('ccass.bigchanges', d='') }}">Big changes all stocks</a></li>
        <li><a href="{{ url_for('ccass.cparticipants') }}">Participants</a></li>
        <li><a target="_blank" href="{{ url_for('ccass.ccass_notes') }}">About CCASS</a></li>
    </ul>
    <div class="clear"></div>
{% endif %}

<form method="get" action="{{ url_for('ccass.bigchangesissue') }}">
    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="i" value="{{ issue_id }}">
    <div class="inputs">
        Stock code: <input type="text" name="sc" size="5" value="">
    </div>
    <div class="inputs">
        <input type="submit" value="Go">
        <input type="submit" value="Clear" onclick="document.getElementById('d').value='';">
    </div>
    <div class="clear"></div>
</form>

<h3>Big changes in CCASS holders</h3>
<p>This table shows daily movements larger than 0.25% of outstanding shares.
Click the "Change" heading to sort by absolute size of change. Click the
participant name to see the history of its holding in this stock. Click the date
of change to see the CCASS movements on that date.</p>

{# Mobile hide columns indicator #}
<p class="widthAlert2">Some data are hidden to fit your display.<span class="portrait"> Rotate?</span></p>

<table class="numtable yscroll">
    <tr>
        <th class="colHide2">Row</th>
        <th>
            <a href="{{ url_for('ccass.bigchangesissue', i=issue_id, sort='datedn' if sort!='datedn' else 'dateup') }}">
                <b>Date<br>Y-M-D</b></a>
        </th>
        <th class="left">
            <a href="{{ url_for('ccass.bigchangesissue', i=issue_id, sort='partup' if sort!='partup' else 'partdn') }}">
                <b>Participant</b></a>
        </th>
        <th>
            <a href="{{ url_for('ccass.bigchangesissue', i=issue_id, sort='chgdn' if sort!='chgdn' else 'chgup') }}">
                <b>Change</b></a>
        </th>
        <th class="colHide3">Previous<br>change</th>
    </tr>
    {% set last_date = None %}
    {% for change in changes %}
    <tr>
        <td class="colHide2">{{ loop.index }}</td>
        <td class="nowrap">
            {% if (sort in ['datedn', 'dateup']) and change.atDate == last_date %}
                {# Suppress duplicate dates when sorted by date #}
            {% else %}
                <a href="{{ url_for('ccass.chldchg', i=issue_id, d=change.atDate.strftime('%Y-%m-%d')) }}">
                    {{ change.atDate.strftime('%Y-%m-%d') }}
                </a>
                {% set last_date = change.atDate %}
            {% endif %}
        </td>
        <td class="left">
            <a href="{{ url_for('ccass.chistory', i=issue_id, part=change.partID) }}">
                {{ change.partName }}
            </a>
        </td>
        <td>{{ "{:.2f}".format(change.stkchg * 100) }}</td>
        <td class="nowrap colHide3">
            {{ change.prevDate.strftime('%Y-%m-%d') if change.prevDate else '' }}
        </td>
    </tr>
    {% endfor %}
</table>

{% if changes|length == 0 %}
    <p>None found.</p>
{% endif %}

{% include 'includes/footer.html' %}
</body>
</html>
