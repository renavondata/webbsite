{% extends "base_database.html" %}

{% block title %}SFC licensee history: all firms: {{ act_name }}{% endblock %}

{% block head_extra %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

function drawChart() {
	var data = google.visualization.arrayToDataTable([
		['Date', 'Licensees'],
		{% for row in history %}
		['{{ row.d }}', {{ row.total|int }}],
		{% endfor %}
	]);

	var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
	chart.draw(data, {
		chartArea: {width:'85%', height:'75%', left:'10%'},
		title: 'Number of licensees: {{ act_name }}',
		titleTextStyle: {fontSize:18},
		backgroundColor: {strokeWidth:2, stroke:'blue'},
		vAxis: {baseline:0},
		legend: 'none'
	});
}

window.addEventListener('resize', drawChart);
</script>
{% endblock %}

{% block content %}
<h2>SFC licensee history: all firms: {{ act_name }}</h2>

<ul class="navlist">
	<li><a href="SFClicount.asp?a={{ act }}">League table</a></li>
	<li><a href="SFCchanges.asp">Latest moves</a></li>
	<li class="livebutton">Historic total</li>
</ul>
<div class="clear"></div>

<form method="get" action="SFChistall.asp">
	<div class="inputs">
		Activity type:
		<select name="a" onchange="this.form.submit()">
			<option value="0" {% if act == 0 %}selected{% endif %}>All</option>
			{# Note: activities dropdown should be populated from database #}
			{# For now using static list - TODO: add activities query to route #}
		</select>
	</div>
	<div class="clear"></div>
</form>

<p>This page shows the historic number of people who are SFC licensees for all firms. Licensees
are either Responsible Officers (<strong>ROs</strong>) or Representatives (<strong>Reps</strong>).
We treat a person who holds both roles (in different categories of license,
possible at different firms) as an RO. Each person is counted only once, even if
she works for more than one firm. To see each firm separately,
select the league table above and then click the firm's history link. Note that
due to a transitional period which ended on 31-Mar-2005, many licenses in some activities were
surrendered or not extended beyond that date.</p>

{% if history %}
	<div class="chart" id="chart_div" style="width:100%; height:500px;"></div>
	<p></p>
	<table class="numtable center">
		<tr>
			<th>Date</th>
			<th>ROs</th>
			<th>Reps</th>
			<th>Total</th>
			<th>Reps v total</th>
		</tr>
		{% for row in history %}
			<tr>
				<td><a href="SFClicount.asp?a={{ act }}&amp;da={{ row.d }}">{{ row.d }}</a></td>
				<td>{{ row.ro }}</td>
				<td>{{ row.reps }}</td>
				<td>{{ row.total }}</td>
				<td>{{ "%.2f%%"|format(row.rep_ratio * 100) if row.rep_ratio else 'â€”' }}</td>
			</tr>
		{% endfor %}
	</table>
{% else %}
	<p><b>This activity has no licence records yet.</b></p>
{% endif %}
{% endblock %}
