{% extends "base.html" %}

{% block title %}Adviserships of {{ org_name }}{% endblock %}

{% block content %}
{% include 'header.html' %}

<h2>{{ org_name }}</h2>

<ul class="navlist">
    <li><a href="?p={{ person_id }}&r={{ role_id }}&sort={{ sort }}&hide=Y" {% if hide == 'Y' %}class="selected"{% endif %}>Current</a></li>
    <li><a href="?p={{ person_id }}&r={{ role_id }}&sort={{ sort }}&hide=N" {% if hide == 'N' %}class="selected"{% endif %}>History</a></li>
    <li><a target="_blank" href="/dbpub/leagueNotesA.asp">Notes</a></li>
    <li><a target="_blank" href="/dbpub/FAQWWW.asp">FAQ</a></li>
</ul>
<div class="clear"></div>

{% if role_name %}
    <form method="get" action="/dbpub/adviserships.asp">
        <input type="hidden" name="p" value="{{ person_id }}">
        <input type="hidden" name="sort" value="{{ sort }}">
        <div class="inputs">
            <select name="r" onchange="this.form.submit()">
                {% for role in all_roles %}
                <option value="{{ role.roleid }}" {% if role.roleid == role_id %}selected{% endif %}>
                    {{ role.rolelong }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="inputs">
            start date: <input type="date" name="f" id="f" value="{{ from_date }}" onblur="this.form.submit()">
        </div>
        <div class="inputs">
            end date: <input type="date" name="t" id="t" value="{{ to_date }}" onblur="this.form.submit()">
        </div>
        {% if one_time %}
        <div class="inputs">
            Performance period
            <select name="y" onchange="this.form.submit()">
                <option value="0.5" {% if years == 0.5 %}selected{% endif %}>0.5</option>
                <option value="1" {% if years == 1.0 %}selected{% endif %}>1</option>
                <option value="2" {% if years == 2.0 %}selected{% endif %}>2</option>
                <option value="3" {% if years == 3.0 %}selected{% endif %}>3</option>
                <option value="5" {% if years == 5.0 %}selected{% endif %}>5</option>
            </select> years
        </div>
        {% else %}
        <div class="inputs">
            <input type="checkbox" name="c" id="c" value="1" {% if include_new %}checked{% endif %} onchange="this.form.submit()">
            <label for="c">include new appointments after start date</label>
        </div>
        {% endif %}
        <div class="inputs">
            <input type="submit" value="Go">
            <input type="button" value="clear" onclick="document.getElementById('f').value='';document.getElementById('t').value='';if(document.getElementById('c'))document.getElementById('c').checked=false;this.form.submit();">
        </div>
        <div class="clear"></div>
    </form>

    <h3>Role: <a href="/dbpub/advbyrole.asp?r={{ role_id }}">{{ role_name }}</a></h3>

    {% if one_time %}
    <p>This is a one-time role. Returns are from the appointment date to the earliest of the end of the specified performance period and the last trading date.</p>
    {% else %}
    <p>This is a continuing role. Total returns are measured from the latest of the start date, the appointment date and 3-Jan-1994
    until the earliest of the end date, the resignation/removal date and the last trading date.
    CAGR is the annualised return and is not shown for periods under 180 days.
    Relative returns are to the <a href="/dbpub/orgdata.asp?p=51819">Tracker Fund of HK</a> (2800), starting from the latest of 12-Nov-1999, the appointment date and the chosen start date.</p>
    {% endif %}

    {% if adviserships %}
        <table class="opltable">
            <tr>
                <th class="colHide1"></th>
                <th>
                    {% if sort == 'orgup' %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=orgdn&hide={{ hide }}">Client ▼</a>
                    {% else %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=orgup&hide={{ hide }}">Client</a>
                    {% endif %}
                </th>
                <th class="colHide2">
                    {% if sort == 'addup' %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=adddn&hide={{ hide }}">Added ▼</a>
                    {% else %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=addup&hide={{ hide }}">Added</a>
                    {% endif %}
                </th>
                {% if not one_time %}
                <th>
                    {% if sort == 'remup' %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=remdn&hide={{ hide }}">Removed ▼</a>
                    {% else %}
                        <a href="?p={{ person_id }}&r={{ role_id }}&sort=remup&hide={{ hide }}">Removed</a>
                    {% endif %}
                </th>
                {% endif %}
            </tr>
            {% set last_org = 0 %}
            {% set cnt = 0 %}
            {% for adv in adviserships %}
                {% if adv.orgid != last_org or (sort[:3] != 'org') %}
                    {% set cnt = cnt + 1 %}
                    <tr class="total">
                        <td class="right colHide1">{{ cnt }}</td>
                        <td><a href="/dbpub/advisers.asp?p={{ adv.orgid }}&hide={{ hide }}">{{ adv.org }}</a></td>
                        <td class="colHide2 nowrap">{{ adv.adddate.strftime('%Y-%m-%d') if adv.adddate else '' }}</td>
                        {% if not one_time %}
                        <td class="nowrap">{{ adv.remdate.strftime('%Y-%m-%d') if adv.remdate else '' }}</td>
                        {% endif %}
                    </tr>
                {% else %}
                    <tr>
                        <td class="colHide1"></td>
                        <td></td>
                        <td class="colHide2 nowrap">{{ adv.adddate.strftime('%Y-%m-%d') if adv.adddate else '' }}</td>
                        {% if not one_time and hide != 'Y' %}
                        <td class="nowrap">{{ adv.remdate.strftime('%Y-%m-%d') if adv.remdate else '' }}</td>
                        {% endif %}
                    </tr>
                {% endif %}
                {% set last_org = adv.orgid %}
            {% endfor %}
        </table>
        <br>
        <p><i>Note: Total returns calculations require additional stored functions and will be implemented in a future update.</i></p>
    {% else %}
        <p>None found.</p>
    {% endif %}
{% else %}
    <p>None found.</p>
{% endif %}

{% include 'footer.html' %}
{% endblock %}
