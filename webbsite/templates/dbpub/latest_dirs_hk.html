{% extends "base_database.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<h2>{{ title }}</h2>
<p>This table shows appointments (including changes of position) of directors of HK-listed companies.
Pick an inclusive start date and end date then click Go. The default range is the last 60 days.
If you change the end date to earlier than the start date then the range will be
60 days up to the end date.
The maximum range is 366 days. Appointments are usually captured from
announcements by the next working day but sometimes we have trouble keeping up.</p>

<form method="get" action="/dbpub/latestdirsHK.asp">
    <input type="hidden" name="sort" value="{{ sort }}">
    <div class="inputs">
        From <input type="date" name="d1" id="d1" value="{{ d1 }}">
    </div>
    <div class="inputs">
        to <input type="date" name="d2" id="d2" value="{{ d2 }}">
    </div>
    <div class="inputs">
        <input type="submit" value="Go">
        <input type="submit" value="Clear" onclick="document.getElementById('d1').value='';document.getElementById('d2').value=''">
    </div>
    <div class="clear"></div>
</form>

<p>Period length: {{ period_days }} days.</p>

{{ mobile_alert|safe }}
<table class="txtable yscroll">
    <tr>
        <th class="colHide1"></th>
        <th>{{ sort_links.director|safe }}</th>
        <th>{{ sort_links.sex|safe }}</th>
        <th class="right">{{ sort_links.age|safe }}</th>
        <th>{{ sort_links.position|safe }}</th>
        <th>{{ sort_links.from|safe }}</th>
        <th class="colHide2">{{ sort_links.company|safe }}</th>
    </tr>
    {% for appt in appointments %}
    <tr>
        <td class="right colHide1">{{ loop.index }}</td>
        <td><a href="/dbpub/positions.asp?p={{ appt.dirid }}">{{ appt.dir }}</a></td>
        <td>{{ appt.sex }}</td>
        <td class="right">{% if appt.age %}{{ appt.age }}{% endif %}</td>
        <td><span class="info">{{ appt.posshort }}<span>{{ appt.poslong }}</span></span></td>
        <td>{{ appt.appt }}</td>
        <td class="colHide2"><a href="/dbpub/officers.asp?p={{ appt.orgid }}">{{ appt.org }}</a></td>
    </tr>
    {% endfor %}
</table>

<h3>Analysis</h3>
<h4>Gender</h4>
<table class="numtable">
    <tr>
        <th>Male</th>
        <th>Female</th>
        <th>Unknown</th>
    </tr>
    <tr>
        <td>{{ stats.male }}</td>
        <td>{{ stats.female }}</td>
        <td>{{ stats.nosex }}</td>
    </tr>
    <tr>
        <td>{{ '%.2f%%'|format(stats.male_pct) }}</td>
        <td>{{ '%.2f%%'|format(stats.female_pct) }}</td>
        <td>{{ '%.2f%%'|format(stats.nosex_pct) }}</td>
    </tr>
</table>

<h4>Average age in {{ now_year }}</h4>
<table class="numtable">
    <tr>
        <th>Male</th>
        <th>Female</th>
        <th>Unknown</th>
        <th>Total</th>
    </tr>
    <tr>
        <td>{{ stats.male_age_cnt }}</td>
        <td>{{ stats.female_age_cnt }}</td>
        <td>{{ stats.nosex_age_cnt }}</td>
        <td>{{ stats.total_age_cnt }}</td>
    </tr>
    <tr>
        <td>{% if stats.male_avg_age %}{{ '%.2f'|format(stats.male_avg_age) }}{% endif %}</td>
        <td>{% if stats.female_avg_age %}{{ '%.2f'|format(stats.female_avg_age) }}{% endif %}</td>
        <td>{% if stats.nosex_avg_age %}{{ '%.2f'|format(stats.nosex_avg_age) }}{% endif %}</td>
        <td>{% if stats.total_avg_age %}{{ '%.2f'|format(stats.total_avg_age) }}{% endif %}</td>
    </tr>
</table>
{% endblock %}
