{% extends "base_database.html" %}

{% block title %}Advisers of: {{ org_name }}{% endblock %}

{% block content %}
<h2>{{ org_name }}</h2>

{# orgBar navigation - matches ASP orgBar() function #}
{% if person_id == 0 %}
{# Simple navigation for non-existent orgs #}
<ul class="navlist">
	<li><a href='/dbpub/orgdata.asp?p=0'>Key Data</a></li>
</ul>
<div class="clear"></div>
{% else %}
{# Full navigation for existing orgs - page 5 = Advisers #}
<ul class="navlist">
	<li><a href='/dbpub/orgdata.asp?p={{ person_id }}'>Key Data</a></li><li><a href='/dbpub/officers.asp?p={{ person_id }}'>Officers</a></li><li><a href='/dbpub/overlap.asp?p={{ person_id }}'>Overlaps</a></li><li><a href='/dbpub/pay.asp?p={{ person_id }}'>Pay</a></li><li class='livebutton'>Advisers</li><li><a href='/dbpub/docs.asp?p={{ person_id }}'>Financials</a></li><li><a href='/dbpub/complain.asp?p={{ person_id }}'>Complain</a></li>
</ul>
<div class="clear"></div>
{% endif %}

{# Current/History navigation - always shown after orgBar (separate from orgBar logic) #}
<ul class='navlist'><li><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&sort={{ sort }}&hide=Y'>Current</a></li><li class='livebutton'>History</li></ul><div class='clear'></div>

<ul class="navlist"><li><a target="_blank" href="FAQWWW.asp">FAQ</a></li></ul>
<div class="clear"></div>
<form method="get" action="advisers.asp">
	<input type="hidden" name="p" value="{{ person_id }}">
	<input type="hidden" name="sort" value="{{ sort }}">
	<div class="inputs">
		Snapshot date: <input type="date" name="d" id="d" value="{{ d }}" onblur="this.form.submit()">
	</div>
	<div class="inputs">
		<input type='checkbox' name='u' id='u' value='1'{% if u %} checked{% endif %} onchange='this.form.submit()'> exclude unknown removal dates
	</div>
	<div class="inputs">
		<input type="submit" value="Go">
		<input type="submit" value="clear" onclick="document.getElementById('d').value='{{ today }}';document.getElementById('u').checked=false;">
	</div>
	<div class="clear"></div>
</form>

<h3>Regular advisers</h3>
{% if regular_advisers|length == 0 %}
<p>None found.</p>
{% else %}
<p class='widthAlert3'>Some data are hidden to fit your display.<span class='portrait'> Rotate?</span></p>
	<table class="opltable">
	<tr>
		<td><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "advup" %}advdn{% else %}advup{% endif %}'><b>Adviser</b></a></td>
		<td><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "rolup" %}roldn{% else %}rolup{% endif %}'><b>Role</b></a></td>
		<td class="colHide3 nowrap"><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "addup" %}adddn{% else %}addup{% endif %}'><b>Added</b></a></td>
		{% if hide != "Y" %}
			<td class="nowrap"><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "remup" %}remdn{% else %}remup{% endif %}'><b>Removed</b></a></td>
		{% endif %}
	</tr>
	{% set last_advid = None %}
	{% for adv in regular_advisers %}
		{% if adv.AdvID == last_advid %}
			<tr>
				<td></td>
				<td>{{ adv.role }}</td>
				<td class="colHide3 nowrap">{{ adv.addDate or '' }}</td>
				{% if hide != "Y" %}
					<td class="nowrap">{{ adv.remDate or '' }}</td>
				{% endif %}
			</tr>
		{% else %}
			<tr class="total">
				<td><a href="adviserships.asp?p={{ adv.AdvID }}&amp;r={{ adv.roleID }}">{{ adv.AdvName }}</a></td>
				<td>{{ adv.role }}</td>
				<td class="colHide3 nowrap">{{ adv.addDate or '' }}</td>
				{% if hide != "Y" %}
					<td class="nowrap">{{ adv.remDate or '' }}</td>
				{% endif %}
			</tr>
			{% set last_advid = adv.AdvID %}
		{% endif %}
	{% endfor %}
	</table>
{% endif %}

<h3>One-time advisers</h3>
{% if onetime_advisers|length == 0 %}
<p>None found.</p>
{% else %}
	<table class="opltable">
	<tr>
		<td><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "advup" %}advdn{% else %}advup{% endif %}'><b>Adviser</b></a></td>
		<td><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "rolup" %}roldn{% else %}rolup{% endif %}'><b>Role</b></a></td>
		<td><a href='/dbpub/advisers.asp?p={{ person_id }}&amp;d={{ d }}&amp;u={{ u }}&amp;sort={% if sort == "addup" %}adddn{% else %}addup{% endif %}'><b>Added</b></a></td>
	</tr>
	{% set last_advid = None %}
	{% for adv in onetime_advisers %}
		{% if adv.AdvID == last_advid %}
			<tr>
				<td></td>
				<td>{{ adv.role }}</td>
				<td>{{ adv.addDate or '' }}</td>
			</tr>
		{% else %}
			<tr class="total">
				<td><a href="adviserships.asp?p={{ adv.AdvID }}&amp;r={{ adv.roleID }}">{{ adv.AdvName }}</a></td>
				<td>{{ adv.role }}</td>
				<td>{{ adv.addDate or '' }}</td>
			</tr>
			{% set last_advid = adv.AdvID %}
		{% endif %}
	{% endfor %}
	</table>
{% endif %}

{% endblock %}
