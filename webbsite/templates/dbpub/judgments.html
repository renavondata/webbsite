{% extends "base_database.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h2>{{ title }}</h2>

<form method="get" action="{{ url_for('dbpub.judgments') }}">
    <div class="inputs">
        <b>Court &nbsp;</b>
        <select name="c" onchange="this.form.submit()">
            <option value="0"{% if c == 0 %} selected{% endif %}>Any</option>
            {% for court in courts %}
            <option value="{{ court.id }}"{% if c == court.id %} selected{% endif %}>{{ court.des }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="clear"></div>

    {% if c > 0 and case_types %}
    <div class="inputs">
        <b>Case type &nbsp;</b>
        <select name="t" onchange="this.form.submit()">
            <option value="0"{% if t == 0 %} selected{% endif %}>Any</option>
            {% for ctype in case_types %}
            <option value="{{ ctype.id }}"{% if t == ctype.id %} selected{% endif %}>{{ ctype.des }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="clear"></div>
    {% endif %}

    <div class="inputs"><b>Judgment date</b>&nbsp;</div>
    <div class="inputs">
        <select name="y">
            <option value="0"{% if y == 0 %} selected{% endif %}>Any year</option>
            {% for year in range(current_year, 1945, -1) %}
            <option value="{{ year }}"{% if y == year %} selected{% endif %}>{{ year }}</option>
            {% endfor %}
        </select>&nbsp;

        <select name="m">
            <option value="0"{% if m == 0 %} selected{% endif %}>Any month</option>
            {% for month in range(1, 13) %}
            <option value="{{ month }}"{% if m == month %} selected{% endif %}>{{ "%02d"|format(month) }}</option>
            {% endfor %}
        </select>&nbsp;

        <select name="d">
            <option value="0"{% if d == 0 %} selected{% endif %}>Any</option>
            {% for day in range(1, 32) %}
            <option value="{{ day }}"{% if d == day %} selected{% endif %}>{{ "%02d"|format(day) }}</option>
            {% endfor %}
        </select>&nbsp;

        <input type="submit" value="Go">
    </div>
    <div class="clear"></div>
    <input type="hidden" name="sort" value="{{ sort_param }}">
</form>

{% if judgments_data|length == 0 %}
    <p>None found. Try widening your search.</p>
{% else %}
    <table class="txtable">
        <tr>
            <th class="colHide3"></th>
            <th>
                {% if sort_param == 'jdup' %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='jddn') }}"><b>Judgment<br>date</b></a>
                {% else %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='jdup') }}">Judgment<br>date</a>
                {% endif %}
            </th>
            <th>
                {% if sort_param == 'cnup' %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='cndn') }}"><b>Case<br>number</b></a>
                {% else %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='cnup') }}">Case<br>number</a>
                {% endif %}
            </th>
            <th class="colHide3">
                {% if sort_param == 'ncup' %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='ncdn') }}"><b>Neutral<br>citation</b></a>
                {% else %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='ncup') }}">Neutral<br>citation</a>
                {% endif %}
            </th>
            <th>
                {% if sort_param == 'psup' %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='psdn') }}"><b>Parties</b></a>
                {% else %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='psup') }}">Parties</a>
                {% endif %}
            </th>
            <th class="colHide3">
                {% if sort_param == 'rpup' %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='rpdn') }}"><b>Reported</b></a>
                {% else %}
                    <a href="{{ url_for('dbpub.judgments', y=y, m=m, d=d, c=c, t=t, sort='rpup') }}">Reported</a>
                {% endif %}
            </th>
        </tr>
        {% for row in judgments_data %}
        {% set rownum = loop.index %}
        {% set case_display = row.casenum %}
        {% if t == 0 %}
            {% set case_display = "<span class='info'>" ~ row.casenum ~ "<span>" ~ row.tdes ~ "</span></span>" %}
            {% if c == 0 %}
                {% set case_display = "<span class='info'>" ~ row.casenum ~ "<span>" ~ row.cdes ~ ": " ~ row.tdes ~ "</span></span>" %}
            {% endif %}
        {% endif %}
        <tr>
            <td class="colHide3">{{ rownum }}</td>
            <td class="nowrap">
                {% if not row.casenum %}
                    <a target="_blank" rel="noopener" href="https://legalref.judiciary.hk/lrs/common/ju/ju_frame.jsp?DIS={{ row.dis }}">{{ row.jdate.strftime('%Y-%m-%d') if row.jdate else '' }}</a>
                {% else %}
                    {{ row.jdate.strftime('%Y-%m-%d') if row.jdate else '' }}
                {% endif %}
            </td>
            <td><a target="_blank" rel="noopener" href="https://legalref.judiciary.hk/lrs/common/ju/ju_frame.jsp?DIS={{ row.dis }}">{{ case_display|safe }}</a></td>
            <td class="colHide3">{{ row.neutcit or '' }}</td>
            <td>{{ row.parties }}{% if row.rs %} sentence{% endif %}{% if row.rv %} verdict{% endif %}</td>
            <td class="colHide3">{{ row.rep or '' }}</td>
        </tr>
        {% endfor %}
    </table>

    {% if judgments_data|length == limit %}
    <p>Only the first {{ limit }} records are shown. Try narrowing your search to a specific court, case type, year, month or day.</p>
    {% endif %}
{% endif %}

{% endblock %}
